import "core-js/stable";
import "regenerator-runtime/runtime";
import { waitForAppScreen, zemu, txFromEtherscan, boilerplateJSON, resolutionConfig, loadConfig, genericTx, } from './test.fixture';
import ledgerService from "@ledgerhq/hw-app-eth/lib/services/ledger"
import { ethers } from "ethers";
import { parseEther } from "ethers/lib/utils";

// Zemu ledger address is 0xfe984369ce3919aa7bb4f431082d027b4f8ed70c

https://etherscan.io/tx/0x8151c3fe62c9215b0c88f00e063e3ef6de0639ebbbef9cc91273095affe25b18
test('[Nano S] nanos_atomicMatch_buyNow_single_NFTaddress_eth_beneficiaryWarning', zemu("nanos", async (sim, eth) => {
  const serializedTx = txFromEtherscan("0x02f90bba0116843b9aca00850c579552348304f76f947f268357a8c2552623316e2562d90e642bb538e588013fbe85edc90000b90b44ab834bab0000000000000000000000007f268357a8c2552623316e2562d90e642bb538e50000000000000000000000007c15f3c5b70477f5d5d1b78b4bc9a905ef5bfedd000000000000000000000000d6ca3ffe8f3ce2553ddf779087ecc7a2ba7f9f520000000000000000000000000000000000000000000000000000000000000000000000000000000000000000baf2127b49fc93cbca6269fade0f7f31df4c88a7000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007f268357a8c2552623316e2562d90e642bb538e5000000000000000000000000d6ca3ffe8f3ce2553ddf779087ecc7a2ba7f9f5200000000000000000000000000000000000000000000000000000000000000000000000000000000000000005b3256965e7c3cf26e11fcaf296dfc8807c01073000000000000000000000000baf2127b49fc93cbca6269fade0f7f31df4c88a70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003e8000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000013fbe85edc9000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000062229d470000000000000000000000000000000000000000000000000000000000000000136e3d17253df7529a3d2098aef66ad0078ab73b62722ef2f227c46349d108ec00000000000000000000000000000000000000000000000000000000000003e8000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000013fbe85edc9000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000062229c63000000000000000000000000000000000000000000000000000000006222b8c3da491c7b3e42890e815de13b2abd526e7048b8da4f57384504d5dd4df98a687e0000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000006a000000000000000000000000000000000000000000000000000000000000007c000000000000000000000000000000000000000000000000000000000000008e00000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000b200000000000000000000000000000000000000000000000000000000000000b20000000000000000000000000000000000000000000000000000000000000001c000000000000000000000000000000000000000000000000000000000000001ce3acc64fcec9a5e9305bf9f4b9cc199aee6d4954594712f5da97709e34bbce9f3f3a780ca273b27536e1879dfb4500191735ee4af58f997f8be53b344f5e5801e3acc64fcec9a5e9305bf9f4b9cc199aee6d4954594712f5da97709e34bbce9f3f3a780ca273b27536e1879dfb4500191735ee4af58f997f8be53b344f5e5801000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e4fb16a59500000000000000000000000000000000000000000000000000000000000000000000000000000000000000007c15f3c5b70477f5d5d1b78b4bc9a905ef5bfedd0000000000000000000000007c87b6ff9c2ec3466c6fac9b89bb58a4bf12a5bb0000000000000000000000000000000000000000000000000000000000001ecc000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e4fb16a595000000000000000000000000d6ca3ffe8f3ce2553ddf779087ecc7a2ba7f9f5200000000000000000000000000000000000000000000000000000000000000000000000000000000000000007c87b6ff9c2ec3466c6fac9b89bb58a4bf12a5bb0000000000000000000000000000000000000000000000000000000000001ecc000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e400000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e4000000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c001a0041c19c1b7c900f984eaa9a542e9f692207dabc6f8980a43046345b75a1aaceaa0747230e777a62e444da2e14785b4a01158b333bb3648119af5251c41239b677b");
  const resolution = await ledgerService.resolveTransaction(
    serializedTx,
    loadConfig,
    resolutionConfig
  );
  const tx = eth.signTransaction(
    "44'/60'/0'/0",
    serializedTx,
    resolution
  );
  await waitForAppScreen(sim);
  await sim.navigateAndCompareSnapshots('.', 'nanos_atomicMatch_buyNow_single_NFTaddress_eth_beneficiaryWarning', [13, 0]);
  await tx;
}));

// https://etherscan.io/tx/0x8151c3fe62c9215b0c88f00e063e3ef6de0639ebbbef9cc91273095affe25b18 // but 'buy-maker' address changed to match ledger address (0x7c15f3c5b70477f5d5d1b78b4bc9a905ef5bfedd -> 0xfe984369ce3919aa7bb4f431082d027b4f8ed70c)
test('[Nano S] nanos_atomicMatch_buyNow_single_NFTaddress_eth', zemu("nanos", async (sim, eth) => {
  const serializedTx = txFromEtherscan("0x02f90bba0116843b9aca00850c579552348304f76f947f268357a8c2552623316e2562d90e642bb538e588013fbe85edc90000b90b44ab834bab0000000000000000000000007f268357a8c2552623316e2562d90e642bb538e5000000000000000000000000fe984369ce3919aa7bb4f431082d027b4f8ed70c000000000000000000000000d6ca3ffe8f3ce2553ddf779087ecc7a2ba7f9f520000000000000000000000000000000000000000000000000000000000000000000000000000000000000000baf2127b49fc93cbca6269fade0f7f31df4c88a7000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007f268357a8c2552623316e2562d90e642bb538e5000000000000000000000000d6ca3ffe8f3ce2553ddf779087ecc7a2ba7f9f5200000000000000000000000000000000000000000000000000000000000000000000000000000000000000005b3256965e7c3cf26e11fcaf296dfc8807c01073000000000000000000000000baf2127b49fc93cbca6269fade0f7f31df4c88a70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003e8000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000013fbe85edc9000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000062229d470000000000000000000000000000000000000000000000000000000000000000136e3d17253df7529a3d2098aef66ad0078ab73b62722ef2f227c46349d108ec00000000000000000000000000000000000000000000000000000000000003e8000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000013fbe85edc9000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000062229c63000000000000000000000000000000000000000000000000000000006222b8c3da491c7b3e42890e815de13b2abd526e7048b8da4f57384504d5dd4df98a687e0000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000006a000000000000000000000000000000000000000000000000000000000000007c000000000000000000000000000000000000000000000000000000000000008e00000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000b200000000000000000000000000000000000000000000000000000000000000b20000000000000000000000000000000000000000000000000000000000000001c000000000000000000000000000000000000000000000000000000000000001ce3acc64fcec9a5e9305bf9f4b9cc199aee6d4954594712f5da97709e34bbce9f3f3a780ca273b27536e1879dfb4500191735ee4af58f997f8be53b344f5e5801e3acc64fcec9a5e9305bf9f4b9cc199aee6d4954594712f5da97709e34bbce9f3f3a780ca273b27536e1879dfb4500191735ee4af58f997f8be53b344f5e5801000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e4fb16a5950000000000000000000000000000000000000000000000000000000000000000000000000000000000000000fe984369ce3919aa7bb4f431082d027b4f8ed70c0000000000000000000000007c87b6ff9c2ec3466c6fac9b89bb58a4bf12a5bb0000000000000000000000000000000000000000000000000000000000001ecc000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e4fb16a595000000000000000000000000d6ca3ffe8f3ce2553ddf779087ecc7a2ba7f9f5200000000000000000000000000000000000000000000000000000000000000000000000000000000000000007c87b6ff9c2ec3466c6fac9b89bb58a4bf12a5bb0000000000000000000000000000000000000000000000000000000000001ecc000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e400000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e4000000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c001a0041c19c1b7c900f984eaa9a542e9f692207dabc6f8980a43046345b75a1aaceaa0747230e777a62e444da2e14785b4a01158b333bb3648119af5251c41239b677b");
  const resolution = await ledgerService.resolveTransaction(
    serializedTx,
    loadConfig,
    resolutionConfig
  );
  const tx = eth.signTransaction(
    "44'/60'/0'/0",
    serializedTx,
    resolution
  );
  await waitForAppScreen(sim);
  await sim.navigateAndCompareSnapshots('.', 'nanos_atomicMatch_buyNow_single_NFTaddress_eth', [11, 0]);
  await tx;
}));

// https://etherscan.io/tx/0x8151c3fe62c9215b0c88f00e063e3ef6de0639ebbbef9cc91273095affe25b18 // but transfer method is modified to raise unknownTransferMethod warning (fb16 -> fb17) and 'buy-maker' address changed to match ledger address (0x7c15f3c5b70477f5d5d1b78b4bc9a905ef5bfedd -> 0xfe984369ce3919aa7bb4f431082d027b4f8ed70c)
test('[Nano S] nanos_atomicMatch_buyNow_single_unknownTransferMethod_NFTaddress_eth', zemu("nanos", async (sim, eth) => {
  const serializedTx = txFromEtherscan("0x02f90bba0116843b9aca00850c579552348304f76f947f268357a8c2552623316e2562d90e642bb538e588013fbe85edc90000b90b44ab834bab0000000000000000000000007f268357a8c2552623316e2562d90e642bb538e5000000000000000000000000fe984369ce3919aa7bb4f431082d027b4f8ed70c000000000000000000000000d6ca3ffe8f3ce2553ddf779087ecc7a2ba7f9f520000000000000000000000000000000000000000000000000000000000000000000000000000000000000000baf2127b49fc93cbca6269fade0f7f31df4c88a7000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007f268357a8c2552623316e2562d90e642bb538e5000000000000000000000000d6ca3ffe8f3ce2553ddf779087ecc7a2ba7f9f5200000000000000000000000000000000000000000000000000000000000000000000000000000000000000005b3256965e7c3cf26e11fcaf296dfc8807c01073000000000000000000000000baf2127b49fc93cbca6269fade0f7f31df4c88a70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003e8000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000013fbe85edc9000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000062229d470000000000000000000000000000000000000000000000000000000000000000136e3d17253df7529a3d2098aef66ad0078ab73b62722ef2f227c46349d108ec00000000000000000000000000000000000000000000000000000000000003e8000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000013fbe85edc9000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000062229c63000000000000000000000000000000000000000000000000000000006222b8c3da491c7b3e42890e815de13b2abd526e7048b8da4f57384504d5dd4df98a687e0000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000006a000000000000000000000000000000000000000000000000000000000000007c000000000000000000000000000000000000000000000000000000000000008e00000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000b200000000000000000000000000000000000000000000000000000000000000b20000000000000000000000000000000000000000000000000000000000000001c000000000000000000000000000000000000000000000000000000000000001ce3acc64fcec9a5e9305bf9f4b9cc199aee6d4954594712f5da97709e34bbce9f3f3a780ca273b27536e1879dfb4500191735ee4af58f997f8be53b344f5e5801e3acc64fcec9a5e9305bf9f4b9cc199aee6d4954594712f5da97709e34bbce9f3f3a780ca273b27536e1879dfb4500191735ee4af58f997f8be53b344f5e5801000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e4fb17a5950000000000000000000000000000000000000000000000000000000000000000000000000000000000000000fe984369ce3919aa7bb4f431082d027b4f8ed70c0000000000000000000000007c87b6ff9c2ec3466c6fac9b89bb58a4bf12a5bb0000000000000000000000000000000000000000000000000000000000001ecc000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e4fb17a595000000000000000000000000d6ca3ffe8f3ce2553ddf779087ecc7a2ba7f9f5200000000000000000000000000000000000000000000000000000000000000000000000000000000000000007c87b6ff9c2ec3466c6fac9b89bb58a4bf12a5bb0000000000000000000000000000000000000000000000000000000000001ecc000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e400000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e4000000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c001a0041c19c1b7c900f984eaa9a542e9f692207dabc6f8980a43046345b75a1aaceaa0747230e777a62e444da2e14785b4a01158b333bb3648119af5251c41239b677b");
  const resolution = await ledgerService.resolveTransaction(
    serializedTx,
    loadConfig,
    resolutionConfig
  );
  const tx = eth.signTransaction(
    "44'/60'/0'/0",
    serializedTx,
    resolution
  );
  await waitForAppScreen(sim);
  await sim.navigateAndCompareSnapshots('.', 'nanos_atomicMatch_buyNow_single_unknownTransferMethod_NFTaddress_eth', [13, 0]);
  await tx;
}));

// https://etherscan.io/tx/0x2ba64df7b335e56574566753fe8eb9560f96145cc603c09357649d7dcaefa140 // but 'buy-maker' address modified to match ledger address (0xaf75696b63745470e74b752c38f8413095d076a7 -> 0xfe984369ce3919aa7bb4f431082d027b4f8ed70c)
test('[Nano S] nanos_atomicMatch_buyNow_single_NFTaddress_weth', zemu("nanos", async (sim, eth) => {
  const serializedTx = txFromEtherscan("0x02f90bb30181d28459682f00851148cf243a83066d30947f268357a8c2552623316e2562d90e642bb538e580b90b44ab834bab0000000000000000000000007f268357a8c2552623316e2562d90e642bb538e5000000000000000000000000dd2b3f1d3a4f08622a25a3f75284fc01ad0c5cca00000000000000000000000000000000000000000000000000000000000000000000000000000000000000005b3256965e7c3cf26e11fcaf296dfc8807c01073000000000000000000000000baf2127b49fc93cbca6269fade0f7f31df4c88a70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc20000000000000000000000007f268357a8c2552623316e2562d90e642bb538e5000000000000000000000000fe984369ce3919aa7bb4f431082d027b4f8ed70c000000000000000000000000dd2b3f1d3a4f08622a25a3f75284fc01ad0c5cca0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000baf2127b49fc93cbca6269fade0f7f31df4c88a70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc20000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000015e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000214e8348c4f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006222ae22000000000000000000000000000000000000000000000000000000006226a2fbaa34e3e28d045c301500f8055ae75752e2373df00eabbd8133d8e9c761ef77880000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000015e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000214e8348c4f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006222aea0000000000000000000000000000000000000000000000000000000000000000003305431553d179bdafdcefdf095078c00adf56a6e8a1051c0169ea243e78ac90000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000006a000000000000000000000000000000000000000000000000000000000000007c000000000000000000000000000000000000000000000000000000000000008e00000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000b200000000000000000000000000000000000000000000000000000000000000b20000000000000000000000000000000000000000000000000000000000000001b000000000000000000000000000000000000000000000000000000000000001bc6fd03d1d2a2ed882329ef5f49a874a96f8d9c37ca9164fa661f508e10ceaf14470961829127f35646ca58ba84d0ce25499dfdc2a05ca2dc63e4b6166d664d43c6fd03d1d2a2ed882329ef5f49a874a96f8d9c37ca9164fa661f508e10ceaf14470961829127f35646ca58ba84d0ce25499dfdc2a05ca2dc63e4b6166d664d43000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e4fb16a5950000000000000000000000000000000000000000000000000000000000000000000000000000000000000000dd2b3f1d3a4f08622a25a3f75284fc01ad0c5cca0000000000000000000000008b4616926705fb61e9c4eeac07cd946a5d4b0760000000000000000000000000000000000000000000000000000000000000257c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e4fb16a595000000000000000000000000af75696b63745470e74b752c38f8413095d076a700000000000000000000000000000000000000000000000000000000000000000000000000000000000000008b4616926705fb61e9c4eeac07cd946a5d4b0760000000000000000000000000000000000000000000000000000000000000257c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e400000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e4000000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c001a05a7143ea9cf51ec40bafb34129c4b3cab92fd1cf89085f13a9cfeb23e43f0e3ba055419091122e775711c7882bb8cbf501a4e5feec71573a4c3f5670bd6a9f1cdf");
  const resolution = await ledgerService.resolveTransaction(
    serializedTx,
    loadConfig,
    resolutionConfig
  );
  const tx = eth.signTransaction(
    "44'/60'/0'/0",
    serializedTx,
    resolution
  );
  await waitForAppScreen(sim);
  await sim.navigateAndCompareSnapshots('.', 'nanos_atomicMatch_buyNow_single_NFTaddress_weth', [11, 0]);
  await tx;
}));

// https://etherscan.io/tx/0x2ba64df7b335e56574566753fe8eb9560f96145cc603c09357649d7dcaefa140 but WETH address modified to raise unknown payment token (c02aaa -> c02aab) and 'buy-maker' address changed to match ledger address (0xaf75696b63745470e74b752c38f8413095d076a7 -> 0xfe984369ce3919aa7bb4f431082d027b4f8ed70c)
test('[Nano S] nanos_atomicMatch_buyNow_single_NFTaddress_unknownPaymentToken', zemu("nanos", async (sim, eth) => {
  const serializedTx = txFromEtherscan("0x02f90bb30181d28459682f00851148cf243a83066d30947f268357a8c2552623316e2562d90e642bb538e580b90b44ab834bab0000000000000000000000007f268357a8c2552623316e2562d90e642bb538e5000000000000000000000000dd2b3f1d3a4f08622a25a3f75284fc01ad0c5cca00000000000000000000000000000000000000000000000000000000000000000000000000000000000000005b3256965e7c3cf26e11fcaf296dfc8807c01073000000000000000000000000baf2127b49fc93cbca6269fade0f7f31df4c88a70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c02aab39b223fe8d0a0e5c4f27ead9083c756cc20000000000000000000000007f268357a8c2552623316e2562d90e642bb538e5000000000000000000000000fe984369ce3919aa7bb4f431082d027b4f8ed70c000000000000000000000000dd2b3f1d3a4f08622a25a3f75284fc01ad0c5cca0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000baf2127b49fc93cbca6269fade0f7f31df4c88a70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc20000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000015e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000214e8348c4f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006222ae22000000000000000000000000000000000000000000000000000000006226a2fbaa34e3e28d045c301500f8055ae75752e2373df00eabbd8133d8e9c761ef77880000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000015e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000214e8348c4f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006222aea0000000000000000000000000000000000000000000000000000000000000000003305431553d179bdafdcefdf095078c00adf56a6e8a1051c0169ea243e78ac90000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000006a000000000000000000000000000000000000000000000000000000000000007c000000000000000000000000000000000000000000000000000000000000008e00000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000b200000000000000000000000000000000000000000000000000000000000000b20000000000000000000000000000000000000000000000000000000000000001b000000000000000000000000000000000000000000000000000000000000001bc6fd03d1d2a2ed882329ef5f49a874a96f8d9c37ca9164fa661f508e10ceaf14470961829127f35646ca58ba84d0ce25499dfdc2a05ca2dc63e4b6166d664d43c6fd03d1d2a2ed882329ef5f49a874a96f8d9c37ca9164fa661f508e10ceaf14470961829127f35646ca58ba84d0ce25499dfdc2a05ca2dc63e4b6166d664d43000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e4fb16a5950000000000000000000000000000000000000000000000000000000000000000000000000000000000000000dd2b3f1d3a4f08622a25a3f75284fc01ad0c5cca0000000000000000000000008b4616926705fb61e9c4eeac07cd946a5d4b0760000000000000000000000000000000000000000000000000000000000000257c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e4fb16a595000000000000000000000000af75696b63745470e74b752c38f8413095d076a700000000000000000000000000000000000000000000000000000000000000000000000000000000000000008b4616926705fb61e9c4eeac07cd946a5d4b0760000000000000000000000000000000000000000000000000000000000000257c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e400000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e4000000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c001a05a7143ea9cf51ec40bafb34129c4b3cab92fd1cf89085f13a9cfeb23e43f0e3ba055419091122e775711c7882bb8cbf501a4e5feec71573a4c3f5670bd6a9f1cdf");
  const resolution = await ledgerService.resolveTransaction(
    serializedTx,
    loadConfig,
    resolutionConfig
  );
  const tx = eth.signTransaction(
    "44'/60'/0'/0",
    serializedTx,
    resolution
  );
  await waitForAppScreen(sim);
  await sim.navigateAndCompareSnapshots('.', 'nanos_atomicMatch_buyNow_single_NFTaddress_unknownPaymentToken', [15, 0]);
  await tx;
}));

// https://etherscan.io/tx/0x0024fa3d3f2f24567f54263e4501b903e285cc5693e8432fc9d2345d6686343d but 'buy-maker' address changed to match ledger address (0xdd2b3f1d3a4f08622a25a3f75284fc01ad0c5cca -> 0xfe984369ce3919aa7bb4f431082d027b4f8ed70c) 
test('[Nano S] nanos_atomicMatch_buyNow_bundle_NFTaddress_eth', zemu("nanos", async (sim, eth) => {
  const serializedTx = txFromEtherscan("0x02f915ba01178459682f008507ae94844c830b84ce947f268357a8c2552623316e2562d90e642bb538e588016345785d8a0000b91544ab834bab0000000000000000000000007f268357a8c2552623316e2562d90e642bb538e5000000000000000000000000fe984369ce3919aa7bb4f431082d027b4f8ed70c000000000000000000000000af75696b63745470e74b752c38f8413095d076a70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c99f70bfd82fb7c8f8191fdfbfb735606b15e5c5000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007f268357a8c2552623316e2562d90e642bb538e5000000000000000000000000af75696b63745470e74b752c38f8413095d076a7000000000000000000000000fe984369ce3919aa7bb4f431082d027b4f8ed70c0000000000000000000000005b3256965e7c3cf26e11fcaf296dfc8807c01073000000000000000000000000c99f70bfd82fb7c8f8191fdfbfb735606b15e5c500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000015e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000016345785d8a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000622379810000000000000000000000000000000000000000000000000000000000000000307643b3abc3d6e688a8ff688072bf040d144640749705d6c42058883cd1e25b000000000000000000000000000000000000000000000000000000000000015e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000016345785d8a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006223794d00000000000000000000000000000000000000000000000000000000622cb2dec4689f14f43054c2d6ab83fe78be0b85602960c3f3b007304d334f1f89f56d0f0000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000006a00000000000000000000000000000000000000000000000000000000000000a400000000000000000000000000000000000000000000000000000000000000de0000000000000000000000000000000000000000000000000000000000000118000000000000000000000000000000000000000000000000000000000000015200000000000000000000000000000000000000000000000000000000000001520000000000000000000000000000000000000000000000000000000000000001b000000000000000000000000000000000000000000000000000000000000001bbefa4f23cc059819dacaf722f67ed7171b5bd24b36ad64e81757d72711a9635022d3dc36a75eb75ee3c89aa6ae6a337daa72989965241def2c6f799236653704befa4f23cc059819dacaf722f67ed7171b5bd24b36ad64e81757d72711a9635022d3dc36a75eb75ee3c89aa6ae6a337daa72989965241def2c6f7992366537040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036468f0bcaa000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000180000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000030000000000000000000000008b4616926705fb61e9c4eeac07cd946a5d4b07600000000000000000000000008b4616926705fb61e9c4eeac07cd946a5d4b07600000000000000000000000008b4616926705fb61e9c4eeac07cd946a5d4b076000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000006400000000000000000000000000000000000000000000000000000000000000640000000000000000000000000000000000000000000000000000000000000064000000000000000000000000000000000000000000000000000000000000012c23b872dd0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000fe984369ce3919aa7bb4f431082d027b4f8ed70c0000000000000000000000000000000000000000000000000000000000001c9e23b872dd0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000fe984369ce3919aa7bb4f431082d027b4f8ed70c0000000000000000000000000000000000000000000000000000000000001f6e23b872dd0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000fe984369ce3919aa7bb4f431082d027b4f8ed70c000000000000000000000000000000000000000000000000000000000000257c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036468f0bcaa000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000180000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000030000000000000000000000008b4616926705fb61e9c4eeac07cd946a5d4b07600000000000000000000000008b4616926705fb61e9c4eeac07cd946a5d4b07600000000000000000000000008b4616926705fb61e9c4eeac07cd946a5d4b076000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000006400000000000000000000000000000000000000000000000000000000000000640000000000000000000000000000000000000000000000000000000000000064000000000000000000000000000000000000000000000000000000000000012c23b872dd000000000000000000000000af75696b63745470e74b752c38f8413095d076a700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001c9e23b872dd000000000000000000000000af75696b63745470e74b752c38f8413095d076a700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001f6e23b872dd000000000000000000000000af75696b63745470e74b752c38f8413095d076a70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000257c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000364000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003640000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c080a0c18def4fd81f6edece3e970fdbdc00ff36cbbd342f07af2d55020bd9139ac340a028fa17bffe0bf7661c9a19dca17d34485a372638077ff3fe98e2b382e0c569eb");
  const resolution = await ledgerService.resolveTransaction(
    serializedTx,
    loadConfig,
    resolutionConfig
  );
  const tx = eth.signTransaction(
    "44'/60'/0'/0",
    serializedTx,
    resolution
  );
  await waitForAppScreen(sim);
  await sim.navigateAndCompareSnapshots('.', 'nanos_atomicMatch_buyNow_bundle_NFTaddress_eth', [11, 0]);
  await tx;
}));

// https://etherscan.io/tx/0x0024fa3d3f2f24567f54263e4501b903e285cc5693e8432fc9d2345d6686343d but collection address modified to raise multipleCollections (8b46 -> 8b47) and 'buy-maker' address changed to match ledger address (0xdd2b3f1d3a4f08622a25a3f75284fc01ad0c5cca -> 0xfe984369ce3919aa7bb4f431082d027b4f8ed70c) 
test('[Nano S] nanos_atomicMatch_buyNow_bundle_multipleCollection_eth', zemu("nanos", async (sim, eth) => {
  const serializedTx = txFromEtherscan("0x02f915ba01178459682f008507ae94844c830b84ce947f268357a8c2552623316e2562d90e642bb538e588016345785d8a0000b91544ab834bab0000000000000000000000007f268357a8c2552623316e2562d90e642bb538e5000000000000000000000000fe984369ce3919aa7bb4f431082d027b4f8ed70c000000000000000000000000af75696b63745470e74b752c38f8413095d076a70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c99f70bfd82fb7c8f8191fdfbfb735606b15e5c5000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007f268357a8c2552623316e2562d90e642bb538e5000000000000000000000000af75696b63745470e74b752c38f8413095d076a7000000000000000000000000fe984369ce3919aa7bb4f431082d027b4f8ed70c0000000000000000000000005b3256965e7c3cf26e11fcaf296dfc8807c01073000000000000000000000000c99f70bfd82fb7c8f8191fdfbfb735606b15e5c500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000015e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000016345785d8a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000622379810000000000000000000000000000000000000000000000000000000000000000307643b3abc3d6e688a8ff688072bf040d144640749705d6c42058883cd1e25b000000000000000000000000000000000000000000000000000000000000015e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000016345785d8a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006223794d00000000000000000000000000000000000000000000000000000000622cb2dec4689f14f43054c2d6ab83fe78be0b85602960c3f3b007304d334f1f89f56d0f0000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000006a00000000000000000000000000000000000000000000000000000000000000a400000000000000000000000000000000000000000000000000000000000000de0000000000000000000000000000000000000000000000000000000000000118000000000000000000000000000000000000000000000000000000000000015200000000000000000000000000000000000000000000000000000000000001520000000000000000000000000000000000000000000000000000000000000001b000000000000000000000000000000000000000000000000000000000000001bbefa4f23cc059819dacaf722f67ed7171b5bd24b36ad64e81757d72711a9635022d3dc36a75eb75ee3c89aa6ae6a337daa72989965241def2c6f799236653704befa4f23cc059819dacaf722f67ed7171b5bd24b36ad64e81757d72711a9635022d3dc36a75eb75ee3c89aa6ae6a337daa72989965241def2c6f7992366537040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036468f0bcaa000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000180000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000030000000000000000000000008b4616926705fb61e9c4eeac07cd946a5d4b07600000000000000000000000008b4716926705fb61e9c4eeac07cd946a5d4b07600000000000000000000000008b4616926705fb61e9c4eeac07cd946a5d4b076000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000006400000000000000000000000000000000000000000000000000000000000000640000000000000000000000000000000000000000000000000000000000000064000000000000000000000000000000000000000000000000000000000000012c23b872dd0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000fe984369ce3919aa7bb4f431082d027b4f8ed70c0000000000000000000000000000000000000000000000000000000000001c9e23b872dd0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000fe984369ce3919aa7bb4f431082d027b4f8ed70c0000000000000000000000000000000000000000000000000000000000001f6e23b872dd0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000fe984369ce3919aa7bb4f431082d027b4f8ed70c000000000000000000000000000000000000000000000000000000000000257c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036468f0bcaa000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000180000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000030000000000000000000000008b4616926705fb61e9c4eeac07cd946a5d4b07600000000000000000000000008b4616926705fb61e9c4eeac07cd946a5d4b07600000000000000000000000008b4616926705fb61e9c4eeac07cd946a5d4b076000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000006400000000000000000000000000000000000000000000000000000000000000640000000000000000000000000000000000000000000000000000000000000064000000000000000000000000000000000000000000000000000000000000012c23b872dd000000000000000000000000af75696b63745470e74b752c38f8413095d076a700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001c9e23b872dd000000000000000000000000af75696b63745470e74b752c38f8413095d076a700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001f6e23b872dd000000000000000000000000af75696b63745470e74b752c38f8413095d076a70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000257c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000364000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003640000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c080a0c18def4fd81f6edece3e970fdbdc00ff36cbbd342f07af2d55020bd9139ac340a028fa17bffe0bf7661c9a19dca17d34485a372638077ff3fe98e2b382e0c569eb");
  const resolution = await ledgerService.resolveTransaction(
    serializedTx,
    loadConfig,
    resolutionConfig
  );
  const tx = eth.signTransaction(
    "44'/60'/0'/0",
    serializedTx,
    resolution
  );
  await waitForAppScreen(sim);
  await sim.navigateAndCompareSnapshots('.', 'nanos_atomicMatch_buyNow_bundle_multipleCollection_eth', [9, 0]);
  await tx;
}));

// https://etherscan.io/tx/0x0024fa3d3f2f24567f54263e4501b903e285cc5693e8432fc9d2345d6686343d but transfer method modified to raise unknownTransferMethod (68f0 -> 68f1) 'buy-maker' address changed to match ledger address (0xdd2b3f1d3a4f08622a25a3f75284fc01ad0c5cca -> 0xfe984369ce3919aa7bb4f431082d027b4f8ed70c) 
test('[Nano S] nanos_atomicMatch_buyNow_bundle_unknownTransferMethod_NFTaddress_eth', zemu("nanos", async (sim, eth) => {
  const serializedTx = txFromEtherscan("0x02f915ba01178459682f008507ae94844c830b84ce947f268357a8c2552623316e2562d90e642bb538e588016345785d8a0000b91544ab834bab0000000000000000000000007f268357a8c2552623316e2562d90e642bb538e5000000000000000000000000fe984369ce3919aa7bb4f431082d027b4f8ed70c000000000000000000000000af75696b63745470e74b752c38f8413095d076a70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c99f70bfd82fb7c8f8191fdfbfb735606b15e5c5000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007f268357a8c2552623316e2562d90e642bb538e5000000000000000000000000af75696b63745470e74b752c38f8413095d076a7000000000000000000000000fe984369ce3919aa7bb4f431082d027b4f8ed70c0000000000000000000000005b3256965e7c3cf26e11fcaf296dfc8807c01073000000000000000000000000c99f70bfd82fb7c8f8191fdfbfb735606b15e5c500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000015e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000016345785d8a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000622379810000000000000000000000000000000000000000000000000000000000000000307643b3abc3d6e688a8ff688072bf040d144640749705d6c42058883cd1e25b000000000000000000000000000000000000000000000000000000000000015e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000016345785d8a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006223794d00000000000000000000000000000000000000000000000000000000622cb2dec4689f14f43054c2d6ab83fe78be0b85602960c3f3b007304d334f1f89f56d0f0000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000006a00000000000000000000000000000000000000000000000000000000000000a400000000000000000000000000000000000000000000000000000000000000de0000000000000000000000000000000000000000000000000000000000000118000000000000000000000000000000000000000000000000000000000000015200000000000000000000000000000000000000000000000000000000000001520000000000000000000000000000000000000000000000000000000000000001b000000000000000000000000000000000000000000000000000000000000001bbefa4f23cc059819dacaf722f67ed7171b5bd24b36ad64e81757d72711a9635022d3dc36a75eb75ee3c89aa6ae6a337daa72989965241def2c6f799236653704befa4f23cc059819dacaf722f67ed7171b5bd24b36ad64e81757d72711a9635022d3dc36a75eb75ee3c89aa6ae6a337daa72989965241def2c6f7992366537040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036468f1bcaa000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000180000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000030000000000000000000000008b4616926705fb61e9c4eeac07cd946a5d4b07600000000000000000000000008b4616926705fb61e9c4eeac07cd946a5d4b07600000000000000000000000008b4616926705fb61e9c4eeac07cd946a5d4b076000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000006400000000000000000000000000000000000000000000000000000000000000640000000000000000000000000000000000000000000000000000000000000064000000000000000000000000000000000000000000000000000000000000012c23b872dd0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000fe984369ce3919aa7bb4f431082d027b4f8ed70c0000000000000000000000000000000000000000000000000000000000001c9e23b872dd0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000fe984369ce3919aa7bb4f431082d027b4f8ed70c0000000000000000000000000000000000000000000000000000000000001f6e23b872dd0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000fe984369ce3919aa7bb4f431082d027b4f8ed70c000000000000000000000000000000000000000000000000000000000000257c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036468f1bcaa000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000180000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000030000000000000000000000008b4616926705fb61e9c4eeac07cd946a5d4b07600000000000000000000000008b4616926705fb61e9c4eeac07cd946a5d4b07600000000000000000000000008b4616926705fb61e9c4eeac07cd946a5d4b076000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000006400000000000000000000000000000000000000000000000000000000000000640000000000000000000000000000000000000000000000000000000000000064000000000000000000000000000000000000000000000000000000000000012c23b872dd000000000000000000000000af75696b63745470e74b752c38f8413095d076a700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001c9e23b872dd000000000000000000000000af75696b63745470e74b752c38f8413095d076a700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001f6e23b872dd000000000000000000000000af75696b63745470e74b752c38f8413095d076a70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000257c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000364000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003640000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c080a0c18def4fd81f6edece3e970fdbdc00ff36cbbd342f07af2d55020bd9139ac340a028fa17bffe0bf7661c9a19dca17d34485a372638077ff3fe98e2b382e0c569eb");
  const resolution = await ledgerService.resolveTransaction(
    serializedTx,
    loadConfig,
    resolutionConfig
  );
  const tx = eth.signTransaction(
    "44'/60'/0'/0",
    serializedTx,
    resolution
  );
  await waitForAppScreen(sim);
  await sim.navigateAndCompareSnapshots('.', 'nanos_atomicMatch_buyNow_bundle_unknownTransferMethod_NFTaddress_eth', [13, 0]);
  await tx;
}));